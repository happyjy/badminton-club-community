# 게시판 기능 구현 계획

## 1. 기능 요구사항

### 게시판 유형
- [ ] **통합 게시판** (카테고리로 분류)
  - 하나의 게시판에서 카테고리별로 게시글 분류
  - 모바일 환경 최적화 (가로 길이 제약 고려)

### 게시글 기능
- [ ] 작성/수정/삭제
- [ ] 조회수 (viewCount)
- [ ] 좋아요 (likeCount)
- [ ] 상단 고정 (isPinned) - 관리자만 가능
- [ ] 이미지 첨부 (향후 구현)
- [ ] 파일 첨부 (향후 구현)

### 댓글 기능
- [ ] 작성/수정/삭제
- [ ] 대댓글 (parentId)
- [ ] 좋아요 (likeCount)
- [ ] Soft delete 지원

### 검색/필터
- [ ] 제목 검색
- [ ] 내용 검색
- [ ] 작성자 검색
- [ ] 카테고리 필터 (카테고리 탭으로 구현)
- [ ] 날짜 범위 필터 (향후 구현)

### 정렬
- [ ] 최신순 (기본)
- [ ] 조회수순
- [ ] 좋아요순
- [ ] 댓글순

### 페이지네이션
- [ ] **반응형 하이브리드 접근**
  - 모바일 (< 768px): 무한 스크롤 (Intersection Observer)
  - PC (≥ 768px): 페이지네이션 버튼
- 스크롤 위치 복원 (뒤로가기 시)

---

## 2. 권한 및 보안

### 카테고리별 작성 권한
- [ ] **PostCategory.allowedRoles** 필드로 카테고리별 작성 권한 관리
  - `["ADMIN"]`: 관리자만 작성 가능 (예: 공지사항)
  - `["MEMBER", "ADMIN"]`: 전체 회원 작성 가능 (기본값, 예: 자유게시판)
- 권한 체크: `canCreatePostInCategory(category.allowedRoles, userRole)`
- 구현 파일: `src/utils/boardPermissions.ts`

### 게시글 수정/삭제 권한
- [ ] 본인 글: 작성자가 수정/삭제 가능
- [ ] 관리자: 모든 게시글 수정/삭제 가능
- 권한 체크: `canEditPost(postAuthorId, currentUserId, clubMember)`

### 게시글 고정 권한
- [ ] 관리자만 가능: 상단 고정 게시글 설정 (Post.isPinned)
- 권한 체크: `canPinPost(clubMember)`

### 카테고리 관리 권한
- [ ] 관리자만 가능: 카테고리 생성/수정/삭제/순서 변경
- 권한 체크: `canManageCategory(clubMember)`

### 향후 구현 예정
- [ ] 비공개 게시글 (작성자/관리자만 조회)
- [ ] 익명 게시글

---

## 3. 카테고리

### 카테고리 관리
- [ ] **PostCategory 모델**로 클럽별 카테고리 동적 관리
- [ ] 관리자가 카테고리 생성/수정/삭제 가능
- [ ] 카테고리 순서 관리 (order 필드)
- [ ] 카테고리 활성화/비활성화 (isActive 필드)

### 카테고리 구조
- `id`: 카테고리 ID
- `clubId`: 클럽 ID (어느 클럽의 카테고리인지)
- `name`: 카테고리 이름 (예: "공지사항", "자유게시판", "갤러리", "모임후기", "장터")
- `description`: 카테고리 설명 (선택)
- `allowedRoles`: 작성 가능한 역할 배열
  - 예시 1: `["ADMIN"]` → 공지사항 (관리자만 작성)
  - 예시 2: `["MEMBER", "ADMIN"]` → 자유게시판 (전체 회원 작성 가능)
- `order`: 정렬 순서 (숫자가 작을수록 위에 표시)
- `isActive`: 활성화 여부 (false면 목록에서 숨김)

### 기본 카테고리 (클럽 생성 시 자동 생성 - 선택사항)
- [ ] 공지사항 (allowedRoles: ["ADMIN"], order: 1)
- [ ] 자유게시판 (allowedRoles: ["MEMBER", "ADMIN"], order: 2)

### 카테고리별 권한 설정
- [ ] **설계 완료**: PostCategory.allowedRoles로 카테고리마다 다른 작성 권한 지정
- 관리자는 카테고리 생성/수정 시 allowedRoles 설정 가능

### 카테고리 UI
- [ ] **ClubNavigation 스타일과 유사한 카테고리 탭**
  - 위치: 게시판 페이지 내부 (ClubNavigation 아래)
  - 스타일: 가로 스크롤 가능한 탭 형태
  - "전체" 탭 포함 (모든 카테고리 게시글 조회)
  - 모바일: 가로 스크롤
  - PC: 한 줄에 표시
- 구현 파일: `src/components/organisms/board/BoardCategoryTabs.tsx`

---

## 4. 데이터 구조 관련

### 게시판과 클럽 관계
- [ ] **클럽별 게시판** (현재 구조)
  - Post.clubId로 각 클럽마다 독립적인 게시판
  - 클럽 회원만 해당 클럽 게시판 조회 가능
  - [ ] 향후 전체 공용 게시판 추가 검토

### 게시글 필드
- [ ] 기본 필드: title, content
- [ ] 메타 필드: viewCount, likeCount, isPinned, isDeleted
- [ ] 태그 (Post.tags: String[] 또는 PostTag 모델)
  - 용도: 게시글 분류 및 검색
  - 예시: ["대회", "모임", "장터"]
  - 우선순위: 낮음
- [ ] 장소 (Post.location: String?)
  - 용도: 모임 장소 정보
  - 우선순위: 낮음
- [ ] 이벤트 날짜 (Post.eventDate: DateTime?)
  - 용도: 모임/이벤트 날짜
  - 우선순위: 낮음

### 파일 첨부
- [ ] 이미지 업로드
  - 갤러리 카테고리: 필수 (향후 구현)
  - 일반 게시판: 선택 (향후 구현)
  - 저장소: [ ] 결정 필요 (Vercel Blob / AWS S3 / 로컬)
  - 용량 제한: [ ] 결정 필요 (예: 5MB)
- [ ] 파일 업로드
  - 필요 여부: [ ] 필요 / [ ] 불필요
  - 저장소: [ ] 결정 필요
  - 용량 제한: [ ] 결정 필요 (예: 20MB)
- 구현 방식: PostAttachment 모델 또는 Post.imageUrls: String[]
- 우선순위: 낮음 (기본 기능 구현 후)

---

## 5. UI/UX

### 목록 페이지
- [ ] 카드 형태 목록 (모바일 친화적)
- [ ] 카테고리 탭 (ClubNavigation 스타일)
- [ ] 정렬 옵션 (드롭다운)
- [ ] 공지 게시글 상단 고정 표시
- [ ] 갤러리 게시글 썸네일 표시 (향후 구현)

### 상세 페이지
- [ ] 게시글 상세 정보
- [ ] 댓글 목록
- [ ] 댓글 작성 폼
- [ ] 수정/삭제 버튼 (권한에 따라 표시)
- [ ] 이전/다음 게시글 네비게이션

### 작성/수정 페이지
- [ ] 제목 입력
- [ ] 내용 입력 (텍스트 에디터)
- [ ] 카테고리 선택
- [ ] 이미지 첨부 (향후 구현)
- [ ] 파일 첨부 (향후 구현)

### 모바일 최적화
- [ ] 반응형 디자인 (Tailwind CSS)
- [ ] 터치 친화적 버튼 크기
- [ ] 가로 스크롤 카테고리 탭
- [ ] 무한 스크롤 (모바일)

---

## 6. 추가 기능

### 알림
- [ ] 댓글 알림 (기존 SMS 시스템 활용 가능)
- [ ] 좋아요 알림
- 우선순위: 중간

### 신고 기능
- [ ] 게시글 신고
- [ ] 댓글 신고
- 우선순위: 낮음

### 게시글 고정
- [ ] 관리자가 게시글 상단 고정 가능
- [ ] 고정 게시글은 목록 상단에 표시

### 게시글 이전/다음 네비게이션
- [ ] 상세 페이지에서 이전/다음 게시글 이동
- 우선순위: 낮음

---

## 7. 데이터베이스 스키마

### 설계된 모델 (구현 예정)

#### PostCategory
```prisma
model PostCategory {
  id            Int      @id @default(autoincrement())
  clubId        Int
  name          String
  description   String?
  allowedRoles  String[] @default(["MEMBER", "ADMIN"])
  order         Int      @default(0)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  club          Club     @relation(...)
  posts          Post[]
}
```

#### Post
```prisma
model Post {
  id            String        @id @default(cuid())
  clubId        Int
  categoryId    Int
  title         String
  content       String
  authorId      Int
  isPinned      Boolean      @default(false)
  viewCount     Int          @default(0)
  likeCount     Int          @default(0)
  isDeleted     Boolean      @default(false)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  
  club          Club         @relation(...)
  category      PostCategory  @relation(...)
  author        ClubMember   @relation("PostAuthor", ...)
  comments      PostComment[]
}
```

#### PostComment
```prisma
model PostComment {
  id            String        @id @default(cuid())
  postId        String
  authorId      Int?
  content       String
  parentId      String?
  isDeleted     Boolean       @default(false)
  likeCount     Int           @default(0)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  
  post          Post          @relation(...)
  author        ClubMember?   @relation("PostCommentAuthor", ...)
  parent        PostComment?  @relation("CommentToComment", ...)
  children      PostComment[] @relation("CommentToComment")
}
```

### 스키마 파일 위치
- `prisma/schema/board.prisma` (생성 필요)
- `prisma/build-schema.ts`에 추가 필요

---

## 8. API 엔드포인트

### 카테고리 관리 (관리자만)
- [ ] `GET /api/clubs/[clubId]/board/categories` - 카테고리 목록 조회
- [ ] `POST /api/clubs/[clubId]/board/categories` - 카테고리 생성
- [ ] `PUT /api/clubs/[clubId]/board/categories/[categoryId]` - 카테고리 수정
- [ ] `DELETE /api/clubs/[clubId]/board/categories/[categoryId]` - 카테고리 삭제
- [ ] `PATCH /api/clubs/[clubId]/board/categories/reorder` - 카테고리 순서 변경

### 게시글
- [ ] `GET /api/clubs/[clubId]/board/posts` - 게시글 목록 조회
  - Query params: categoryId, page, limit, sort
- [ ] `GET /api/clubs/[clubId]/board/posts/[postId]` - 게시글 상세 조회
- [ ] `POST /api/clubs/[clubId]/board/posts` - 게시글 작성
- [ ] `PUT /api/clubs/[clubId]/board/posts/[postId]` - 게시글 수정
- [ ] `DELETE /api/clubs/[clubId]/board/posts/[postId]` - 게시글 삭제
- [ ] `PATCH /api/clubs/[clubId]/board/posts/[postId]/pin` - 게시글 고정/해제
- [ ] `POST /api/clubs/[clubId]/board/posts/[postId]/like` - 좋아요 토글

### 댓글
- [ ] `GET /api/clubs/[clubId]/board/posts/[postId]/comments` - 댓글 목록 조회
- [ ] `POST /api/clubs/[clubId]/board/posts/[postId]/comments` - 댓글 작성
- [ ] `PUT /api/clubs/[clubId]/board/posts/[postId]/comments/[commentId]` - 댓글 수정
- [ ] `DELETE /api/clubs/[clubId]/board/posts/[postId]/comments/[commentId]` - 댓글 삭제
- [ ] `POST /api/clubs/[clubId]/board/posts/[postId]/comments/[commentId]/like` - 댓글 좋아요 토글

---

## 9. 구현 단계

### Phase 1: 기본 구조 (우선순위: 높음)
1. [x] 데이터베이스 스키마 설계 및 마이그레이션
2. [x] 권한 체크 유틸리티 함수 구현
3. [x] 카테고리 관리 API 구현
4. [x] 게시글 CRUD API 구현
5. [x] 댓글 CRUD API 구현

### Phase 2: 프론트엔드 기본 기능 (우선순위: 높음)
1. [ ] ClubNavigation에 게시판 메뉴 추가
2. [ ] 카테고리 탭 컴포넌트 (BoardCategoryTabs)
3. [ ] 게시판 목록 페이지
4. [ ] 게시글 상세 페이지
5. [ ] 게시글 작성/수정 페이지
6. [ ] 댓글 컴포넌트

### Phase 3: 고급 기능 (우선순위: 중간)
1. [ ] 무한 스크롤 (모바일)
2. [ ] 페이지네이션 (PC)
3. [ ] 좋아요 기능
4. [ ] 조회수 증가
5. [ ] 게시글 고정 기능

### Phase 4: 카테고리 관리 UI (우선순위: 중간)
1. [ ] 카테고리 관리 페이지 (관리자)
2. [ ] 카테고리 생성/수정 폼
3. [ ] 카테고리 순서 변경 (드래그 앤 드롭)

### Phase 5: 추가 기능 (우선순위: 낮음)
1. [ ] 검색 기능
2. [ ] 정렬 옵션 확장
3. [ ] 이미지 첨부
4. [ ] 파일 첨부
5. [ ] 알림 기능

---

## 10. 기술 스택

### Backend
- Next.js API Routes
- Prisma ORM
- PostgreSQL
- 권한 체크: `src/utils/boardPermissions.ts`

### Frontend
- Next.js 14 (Pages Router)
- React 18
- TypeScript
- Tailwind CSS
- React Query (@tanstack/react-query)
- Axios

### 상태 관리
- React Query (서버 상태)
- React State (로컬 상태)

---

## 11. 파일 구조

### 컴포넌트
```
src/components/
├── organisms/
│   └── board/
│       ├── BoardCategoryTabs.tsx      # 카테고리 탭
│       ├── PostCard.tsx               # 게시글 카드
│       ├── PostList.tsx               # 게시글 목록
│       ├── PostDetail.tsx             # 게시글 상세
│       ├── PostForm.tsx               # 게시글 작성/수정 폼
│       └── CategoryManageForm.tsx     # 카테고리 관리 폼 (관리자)
└── molecules/
    └── board/
        ├── CommentItem.tsx            # 댓글 아이템
        └── CommentList.tsx            # 댓글 목록
```

### 페이지
```
src/pages/
└── clubs/
    └── [id]/
        └── board/
            ├── index.tsx              # 게시판 목록
            ├── [postId]/
            │   └── index.tsx          # 게시글 상세
            ├── new.tsx                # 게시글 작성
            ├── [postId]/edit.tsx      # 게시글 수정
            └── categories/
                └── index.tsx          # 카테고리 관리 (관리자)
```

### API
```
src/pages/api/
└── clubs/
    └── [id]/
        └── board/
            ├── categories/
            │   ├── index.ts           # 카테고리 목록/생성
            │   ├── [categoryId].ts    # 카테고리 수정/삭제
            │   └── reorder.ts         # 카테고리 순서 변경
            ├── posts/
            │   ├── index.ts           # 게시글 목록/생성
            │   └── [postId]/
            │       ├── index.ts       # 게시글 상세/수정/삭제
            │       ├── pin.ts         # 게시글 고정
            │       ├── like.ts        # 좋아요
            │       └── comments/
            │           ├── index.ts   # 댓글 목록/생성
            │           └── [commentId].ts  # 댓글 수정/삭제
```

### 유틸리티
```
src/utils/
└── boardPermissions.ts    # 권한 체크 함수
```

### 타입
```
src/types/
└── board.types.ts         # 게시판 관련 타입 정의
```

---

## 12. 마이그레이션

### 실행 명령어
```bash
npx prisma migrate dev --name add_board_models
npx prisma generate
```

### 마이그레이션 내용
- PostCategory 모델 추가
- Post 모델 추가
- PostComment 모델 추가
- Club, ClubMember 모델에 관계 추가

---

## 13. 참고 사항

### 기존 코드 패턴
- GuestPost/GuestComment 구조 참고 (게시글/댓글 패턴)
- ClubNavigation 스타일 참고 (카테고리 탭 UI)
- 권한 체크: `src/utils/permissions.ts` 패턴 참고
- API 구조: `/api/clubs/[clubId]/guests` 패턴 참고

### 주의사항
- ClubNavigation에 게시판 메뉴 추가 필요 (현재 주석 처리됨)
- 기존 게스트 신청 게시글(GuestPost)과는 별도 시스템
- 모바일 환경 최적화 필수 (반응형 디자인)

### 규칙 준수
- 컴포넌트 export는 파일 하단에 별도로 분리
- 이벤트 핸들러는 'on' 접두사 사용
- axios 사용 (fetch 대신)
- early return 패턴 사용

---

## 14. 체크리스트

### 데이터베이스
- [x] PostCategory 모델 설계
- [x] Post 모델 설계
- [x] PostComment 모델 설계
- [x] 관계 설정
- [x] board.prisma 파일 생성
- [x] build-schema.ts에 추가
- [ ] 마이그레이션 실행 (사용자가 직접 실행 필요: `npx prisma migrate dev --name add_board_models`)

### Backend
- [x] 카테고리 관리 API
- [x] 게시글 CRUD API
- [x] 댓글 CRUD API
- [x] 권한 체크 적용

### Frontend
- [ ] 카테고리 탭 컴포넌트
- [ ] 게시판 목록 페이지
- [ ] 게시글 상세 페이지
- [ ] 게시글 작성/수정 페이지
- [ ] 댓글 기능
- [ ] 무한 스크롤 (모바일)
- [ ] 페이지네이션 (PC)

### 테스트
- [ ] API 테스트
- [ ] 컴포넌트 테스트
- [ ] 통합 테스트

---

## 15. 향후 개선 사항

- [ ] 이미지/파일 업로드 기능
- [ ] 검색 기능 강화
- [ ] 알림 시스템 연동
- [ ] 성능 최적화 (캐싱, 인덱싱)
- [ ] SEO 최적화
