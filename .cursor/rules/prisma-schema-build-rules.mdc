---
description: Prisma 스키마 빌드 규칙 - schema 폴더와 build-schema.ts 기반 통합 빌드 방식
globs: prisma/**/*
alwaysApply: true
---

# Prisma 스키마 빌드 규칙

## AI 작업 시 필수 지침 (Prisma 모델 추가/수정 시)

- **절대 금지**: `prisma/schema.prisma`를 직접 수정하지 않는다. 이 파일은 생성 결과물이다.
- **필수 작업**: 모델 추가/수정은 반드시 `prisma/schema/` 폴더의 `.prisma` 파일에서 수행한다.
- **필수 작업**: 작업 완료 후 `pnpm run build:schema`를 실행하여 `schema.prisma`를 생성한다.

## 핵심 개념

- **`prisma/schema.prisma`**는 **생성된 파일**이다. 수동 편집 시 `build:schema` 실행 시 덮어쓰인다.
- **실제 편집 대상**은 `prisma/schema/` 폴더 내 개별 `.prisma` 파일이다.
- **`prisma/build-schema.ts`**가 `schema/` 폴더의 파일들을 순서대로 합쳐 `schema.prisma`를 생성한다.

## 파일 구조

```
prisma/
├── build-schema.ts    # 빌드 스크립트 (schemaFiles 순서 정의)
├── schema.prisma      # 생성 결과물 (자동 생성, 직접 편집 금지)
└── schema/            # 편집 대상 소스
    ├── _base.prisma
    ├── enums.prisma
    ├── user.prisma
    ├── club.prisma
    ├── board.prisma
    └── ... (기능별 파일)
```

## 새 모델/도메인 추가 시 체크리스트

새 기능(예: 회비 정산)용 모델을 추가할 때 반드시 다음을 수행한다.

1. **`prisma/schema/`에 새 파일 생성**
   - 예: `membershipFee.prisma`
   - 해당 도메인에 필요한 enum, model 정의

2. **`prisma/build-schema.ts`의 `schemaFiles` 배열에 등록**
   - 의존성 순서 고려: 참조되는 모델(예: Club, ClubMember)이 있는 파일보다 **뒤에** 배치
   ```ts
   const schemaFiles = [
     '_base.prisma',
     'enums.prisma',
     'user.prisma',
     'club.prisma',
     // ...
     'membershipFee.prisma',  // 새 파일 추가
   ];
   ```

3. **관계가 있는 기존 모델에 inverse relation 필드 추가**
   - 새 모델이 `Club`, `ClubMember` 등을 참조하면 해당 파일에 relation 필드 추가
   - 예: `club.prisma`의 Club, ClubMember에 `membershipFees`, `coupleMembers` 등 추가

4. **빌드 실행 및 검증**
   - `pnpm run build:schema` 실행
   - `prisma generate` 또는 `prisma migrate dev`로 검증

## schemaFiles 순서 원칙

- **의존성 순서**: 참조하는 쪽이 참조당하는 쪽보다 뒤에 와야 함
- 예: `MembershipFee`가 `Club`을 참조 → `membershipFee.prisma`는 `club.prisma` 뒤에 배치

## 주의사항

- `schema.prisma`에 직접 새 모델을 추가하면 `build:schema` 실행 시 **삭제**된다.
- 새 도메인 추가 시 `build-schema.ts` 등록을 빼먹지 않는다.
- Prisma relation은 양쪽 모델 모두에 필드가 있어야 하므로, 기존 모델 수정이 필요하다.
