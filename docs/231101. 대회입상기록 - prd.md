# 대회입상기록 - PRD v1.0

메타

- 문서 버전: v1.0 (초안)
- 관련 코드: `src/components/atoms/inputs/DatePicker.tsx`, `src/components/organisms/modal/JoinClubModal.tsx:384`
- 연관 도메인: 회원 프로필, 파일 업로드, 클럽 멤버십

## 1. 배경/문제 정의

- 회원이 개인 프로필에 대회 입상 기록(대회명, 종목/급수, 날짜, 결과 사진)을 누적 관리하고, 다른 회원이 조회할 수 있도록 한다.
- 현재는 입상 기록을 수집/표시하는 구조가 없어 구두/외부메모에 의존하며 신뢰성/일관성이 떨어짐.

## 2. 목표/지표

- 신규: 회원 중 입상 기록 1건 이상 등록 비율 X%.
- 사용성: 입상 기록 추가 완료까지 평균 단계 수 ≤ 3단계.
- 품질: 이미지 업로드 실패율 ≤ 1%, 중복 기록(동일 대회/종목/날짜/클럽) 생성률 ≤ 2%.

## 3. 사용자/시나리오

- 회원으로서, 내 프로필에 입상 기록을 여러 건 추가/수정/삭제하고 싶다.
- 타 회원의 프로필에서 해당 회원의 입상 기록을 시간순(최신순)으로 보고 싶다.
- 관리자/운영자는 부적절한 이미지나 잘못된 기록을 숨김 처리할 수 있어야 한다(확장 고려).

## 4. 용어/범위 정의

- 종목: 단식, 남자복식, 여자복식, 혼합복식(혼복).
- 급수: A, B, C, D, E(초심), F(왕초심) — `JoinClubModal.tsx:384`의 옵션과 일관 유지.
- 기록 단위: 한 대회에서 한 회원이 특정 종목/급수로 참여한 1건.

## 5. 기능 요구사항

### 5.1 생성/추가

- 프로필 편집 화면에서 “입상 기록 추가” 플러스 버튼을 통해 반복적으로 추가 가능.
- 입력 항목
  - 대회명(필수, 문자열 1~50자)
  - 대회 날짜(필수, Date) — 컴포넌트: `src/components/atoms/inputs/DatePicker.tsx`
  - 참여 종목(필수): 단식/남복/여복/혼복
  - 급수(필수): A/B/C/D/E(초심)/F(왕초심) — `src/components/organisms/modal/JoinClubModal.tsx:384` Select 옵션 참조
  - 결과 사진(선택, 0~3장) — 파일 업로드(이미지: jpg/png/webp, 10MB 이하/장)
  - 비고(선택, 0~100자)
- 하나의 폼에서 여러 항목을 연속 추가할 수 있어야 함(동적 리스트 + 플러스 버튼 UX).

### 5.2 조회(View)

- 회원 프로필 페이지에 “입상 기록” 섹션을 제공, 기본 정렬은 최신 대회 날짜 내림차순.
- 각 기록 카드에 주요 정보(대회명, 날짜, 종목/급수, 썸네일 1장)를 노출, 클릭 시 상세(이미지 갤러리, 비고).
- 이미지가 없는 경우 플레이스홀더 처리.

### 5.3 수정/삭제

- 작성자 본인은 본인 기록만 수정/삭제 가능.
- 삭제 시 사용자 확인 모달 노출, 복구는 고려 대상(초기 버전은 영구 삭제로 단순화).

### 5.4 중복/정합성 정책

- 동일 회원·대회 날짜·종목·급수 조합의 중복 생성 방지(서버 측 유니크 제약 또는 사전 검증).
- 다중 클럽 가입 가능성 고려: 회원-ID 기준으로 기록을 저장(클럽 종속 아님). 필요 시 “소속 클럽” 메타 필드(선택) 확장.

## 6. 화면/플로우(초안)

1. 프로필 편집 → 입상 기록 섹션 → [+] 추가 버튼
2. 모달/섹션 내 폼에 항목 입력(날짜: DatePicker, Select: 종목/급수, 파일 업로드)
3. 저장 시 즉시 리스트에 추가되고 서버 반영(낙관적 업데이트 가능)
4. 프로필 상세에서 카드 리스트로 노출, 클릭 시 상세 보기

## 7. 데이터/스키마 영향(초안)

- 모델 예시(UserAwardRecord)
  - id (PK)
  - userId (FK: User)
  - tournamentName (string, 1~50)
  - eventType (enum: SINGLES | MD | WD | XD)
  - grade (enum: A | B | C | D | E | F)
  - eventDate (date)
  - images (string[] or 별도 Image 테이블)
  - note (string?, ≤100)
  - createdAt/updatedAt
- 제약/인덱스
  - 유니크: (userId, eventDate, eventType, grade)
  - eventDate index(조회 정렬 최적화)
  - 이미지 스토리지 경로/키 관리(외부 스토리지 연계 시 URL/키 저장)

## 8. API 계약(초안)

- POST `/api/users/me/awards`
  - Req: { tournamentName, eventDate, eventType, grade, images?, note? }
  - Res: { id, ...payload, createdAt }
- GET `/api/users/[userId]/awards`
  - Query: { orderBy=eventDate desc }
  - Res: [{ id, tournamentName, eventDate, eventType, grade, images, note }]
- PATCH `/api/users/me/awards/[awardId]`
  - Req: Partial<{ tournamentName, eventDate, eventType, grade, images, note }>
  - Res: updated record
- DELETE `/api/users/me/awards/[awardId]`
  - Res: { ok: true }
- 업로드: POST `/api/uploads/images` (또는 기존 업로드 라우트 재사용) → URL/키 반환

에러 코드(예시)

- 400 INVALID_PAYLOAD, 409 DUPLICATE_RECORD, 413 PAYLOAD_TOO_LARGE(업로드), 415 UNSUPPORTED_MEDIA_TYPE, 403 FORBIDDEN(권한), 404 NOT_FOUND

## 9. 권한/보안/개인정보

- 가시성: 기본은 전체 공개(프로필 공개 범위 정책에 따름). 추후 공개 범위(전체/클럽/비공개) 확장 가능.
- 권한: 생성/수정/삭제는 본인만. 운영자 숨김 처리(옵션) 별도 정책 문서화.
- 개인정보: 이미지 내 민감정보 모자이크/신고 처리 가이드(운영 문서로 분리).

## 10. 수용 기준(AC)

- AC-1: 회원은 플러스 버튼으로 입상 기록을 연속 추가할 수 있다.
- AC-2: 날짜는 DatePicker로 입력되며, 빈 값 저장은 불가하다.
- AC-3: 종목/급수는 지정된 옵션만 선택 가능하며, 저장 시 검증된다.
- AC-4: 동일 회원·날짜·종목·급수 중복은 서버에서 차단되고 409을 반환한다.
- AC-5: 이미지 업로드는 0~3장, 형식/용량 검증을 통과해야 저장된다.
- AC-6: 프로필 화면에서 최신순으로 리스트가 표시되고, 상세에서 이미지/비고가 보인다.
- AC-7: 작성자는 자신의 기록을 수정/삭제할 수 있다. 삭제 시 확인 모달이 뜬다.

## 11. NFR/품질

- 성능: 프로필 조회 TTFB p95 ≤ 400ms(서버), 이미지 lazy-load.
- 안정성: 업로드 실패 시 재시도 1회, 부분 실패 시 사용자 메시지 명확.
- 접근성: 폼 라벨/에러 메시지, 키보드 내비게이션, 색 대비 준수.

## 12. 로그/모니터링

- 이벤트: award_created/updated/deleted, upload_succeeded/failed
- 필드: userId, eventType, grade, eventDate, imageCount

## 13. 릴리스/운영 계획

- 단계적 출시: 프로필 편집 → 조회 → 이미지 업로드(최대 개수 제한) 순차 활성화 가능.
- 롤백: 스키마 마이그레이션 롤백 스크립트 준비, API 플래그 비활성.

## 14. 오픈 이슈/결정 필요 사항

- 대회명 자동완성/사전 구축 여부.
- 이미지 검수/신고 흐름 포함 여부(운영 정책).
- 다중 클럽 문맥 표시(선택 필드) 도입 시 UX 위치.
